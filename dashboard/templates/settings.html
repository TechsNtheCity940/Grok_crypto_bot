{% extends "base.html" %}

{% block title %}Settings - Crypto Trading Bot{% endblock %}

{% block content %}
<div class="container-fluid">
    <h1 class="mb-4">Settings</h1>
    
    <!-- Settings Tabs -->
    <div class="card">
        <div class="card-header">
            <ul class="nav nav-tabs card-header-tabs" id="settings-tabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="general-tab" data-bs-toggle="tab" data-bs-target="#general" type="button" role="tab" aria-controls="general" aria-selected="true">
                        <i class="fas fa-cog me-2"></i> General
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="trading-tab" data-bs-toggle="tab" data-bs-target="#trading" type="button" role="tab" aria-controls="trading" aria-selected="false">
                        <i class="fas fa-exchange-alt me-2"></i> Trading
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="risk-tab" data-bs-toggle="tab" data-bs-target="#risk" type="button" role="tab" aria-controls="risk" aria-selected="false">
                        <i class="fas fa-shield-alt me-2"></i> Risk Management
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="api-tab" data-bs-toggle="tab" data-bs-target="#api" type="button" role="tab" aria-controls="api" aria-selected="false">
                        <i class="fas fa-key me-2"></i> API Keys
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="notifications-tab" data-bs-toggle="tab" data-bs-target="#notifications" type="button" role="tab" aria-controls="notifications" aria-selected="false">
                        <i class="fas fa-bell me-2"></i> Notifications
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="advanced-tab" data-bs-toggle="tab" data-bs-target="#advanced" type="button" role="tab" aria-controls="advanced" aria-selected="false">
                        <i class="fas fa-code me-2"></i> Advanced
                    </button>
                </li>
            </ul>
        </div>
        <div class="card-body">
            <div class="tab-content" id="settings-tabs-content">
                <!-- General Settings Tab -->
                <div class="tab-pane fade show active" id="general" role="tabpanel" aria-labelledby="general-tab">
                    <form id="general-settings-form">
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="active-exchange" class="form-label">Active Exchange</label>
                                    <select class="form-select" id="active-exchange">
                                        <option value="kraken" selected>Kraken</option>
                                        <option value="binance">Binance</option>
                                        <option value="coinbase">Coinbase</option>
                                        <option value="kucoin">KuCoin</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Trading Pairs</label>
                                    <div class="trading-pairs-container">
                                        <div class="d-flex mb-2">
                                            <select class="form-select me-2 trading-pair-select">
                                                <option value="BTC/USD" selected>BTC/USD</option>
                                                <option value="ETH/USD">ETH/USD</option>
                                                <option value="XRP/USD">XRP/USD</option>
                                                <option value="DOGE/USD">DOGE/USD</option>
                                                <option value="SHIB/USD">SHIB/USD</option>
                                                <option value="SOL/USD">SOL/USD</option>
                                                <option value="ADA/USD">ADA/USD</option>
                                                <option value="DOT/USD">DOT/USD</option>
                                            </select>
                                            <button type="button" class="btn btn-outline-danger remove-pair-btn">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                        <div class="d-flex mb-2">
                                            <select class="form-select me-2 trading-pair-select">
                                                <option value="BTC/USD">BTC/USD</option>
                                                <option value="ETH/USD" selected>ETH/USD</option>
                                                <option value="XRP/USD">XRP/USD</option>
                                                <option value="DOGE/USD">DOGE/USD</option>
                                                <option value="SHIB/USD">SHIB/USD</option>
                                                <option value="SOL/USD">SOL/USD</option>
                                                <option value="ADA/USD">ADA/USD</option>
                                                <option value="DOT/USD">DOT/USD</option>
                                            </select>
                                            <button type="button" class="btn btn-outline-danger remove-pair-btn">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                        <div class="d-flex mb-2">
                                            <select class="form-select me-2 trading-pair-select">
                                                <option value="BTC/USD">BTC/USD</option>
                                                <option value="ETH/USD">ETH/USD</option>
                                                <option value="XRP/USD" selected>XRP/USD</option>
                                                <option value="DOGE/USD">DOGE/USD</option>
                                                <option value="SHIB/USD">SHIB/USD</option>
                                                <option value="SOL/USD">SOL/USD</option>
                                                <option value="ADA/USD">ADA/USD</option>
                                                <option value="DOT/USD">DOT/USD</option>
                                            </select>
                                            <button type="button" class="btn btn-outline-danger remove-pair-btn">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-outline-primary btn-sm mt-2" id="add-pair-btn">
                                        <i class="fas fa-plus me-1"></i> Add Trading Pair
                                    </button>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="update-interval" class="form-label">Update Interval (hours)</label>
                                    <input type="number" class="form-control" id="update-interval" value="1" min="0.1" max="24" step="0.1">
                                    <div class="form-text">How often to fetch new data and update models</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="retrain-interval" class="form-label">Retrain Interval (hours)</label>
                                    <input type="number" class="form-control" id="retrain-interval" value="24" min="1" max="168" step="1">
                                    <div class="form-text">How often to fully retrain models</div>
                                </div>
                                
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="use-enhanced-data" checked>
                                    <label class="form-check-label" for="use-enhanced-data">Use Enhanced Data</label>
                                    <div class="form-text">Fetch data from multiple exchanges and include on-chain metrics</div>
                                </div>
                                
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="use-performance-tracking" checked>
                                    <label class="form-check-label" for="use-performance-tracking">Enable Performance Tracking</label>
                                    <div class="form-text">Track and analyze trading performance</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="model-dir" class="form-label">Model Directory</label>
                            <input type="text" class="form-control" id="model-dir" value="models/trained_models">
                            <div class="form-text">Directory where trained models are stored</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="log-file" class="form-label">Log File</label>
                            <input type="text" class="form-control" id="log-file" value="crypto_trading_bot.log">
                            <div class="form-text">Path to log file</div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Save General Settings</button>
                    </form>
                </div>
                
                <!-- Trading Settings Tab -->
                <div class="tab-pane fade" id="trading" role="tabpanel" aria-labelledby="trading-tab">
                    <form id="trading-settings-form">
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <h5 class="mb-3">Model Settings</h5>
                                
                                <div class="mb-3">
                                    <label class="form-label">Model Types</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="use-lstm" checked>
                                        <label class="form-check-label" for="use-lstm">LSTM</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="use-hybrid" checked>
                                        <label class="form-check-label" for="use-hybrid">Hybrid</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="use-transformer" checked>
                                        <label class="form-check-label" for="use-transformer">Transformer</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="use-reinforcement" checked>
                                        <label class="form-check-label" for="use-reinforcement">Reinforcement Learning</label>
                                    </div>
                                </div>
                                
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="use-ensemble-weighting" checked>
                                    <label class="form-check-label" for="use-ensemble-weighting">Use Ensemble Weighting</label>
                                    <div class="form-text">Weight models based on recent performance</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Strategy Selection</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="use-strategy-selector" checked>
                                        <label class="form-check-label" for="use-strategy-selector">Use Strategy Selector</label>
                                        <div class="form-text">Automatically select best strategy based on market conditions</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <h5 class="mb-3">Order Settings</h5>
                                
                                <div class="mb-3">
                                    <label for="default-order-size" class="form-label">Default Order Size (%)</label>
                                    <input type="number" class="form-control" id="default-order-size" value="10" min="1" max="100">
                                    <div class="form-text">Percentage of available balance to use for each trade</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="min-order-size" class="form-label">Minimum Order Size (USD)</label>
                                    <input type="number" class="form-control" id="min-order-size" value="10" min="1" max="1000">
                                    <div class="form-text">Minimum order size in USD</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="order-type" class="form-label">Order Type</label>
                                    <select class="form-select" id="order-type">
                                        <option value="market" selected>Market</option>
                                        <option value="limit">Limit</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="use-stop-loss" checked>
                                    <label class="form-check-label" for="use-stop-loss">Use Stop Loss</label>
                                </div>
                                
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="use-take-profit" checked>
                                    <label class="form-check-label" for="use-take-profit">Use Take Profit</label>
                                </div>
                            </div>
                        </div>
                        
                        <h5 class="mb-3">Trading Schedule</h5>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="use-trading-schedule">
                            <label class="form-check-label" for="use-trading-schedule">Use Trading Schedule</label>
                            <div class="form-text">Only trade during specified hours</div>
                        </div>
                        
                        <div class="row mb-3" id="trading-schedule-container" style="display: none;">
                            <div class="col-md-6">
                                <label for="trading-start-time" class="form-label">Start Time (UTC)</label>
                                <input type="time" class="form-control" id="trading-start-time" value="00:00">
                            </div>
                            <div class="col-md-6">
                                <label for="trading-end-time" class="form-label">End Time (UTC)</label>
                                <input type="time" class="form-control" id="trading-end-time" value="23:59">
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Save Trading Settings</button>
                    </form>
                </div>
                
                <!-- Risk Management Tab -->
                <div class="tab-pane fade" id="risk" role="tabpanel" aria-labelledby="risk-tab">
                    <form id="risk-settings-form">
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="advanced-risk" checked>
                                    <label class="form-check-label" for="advanced-risk">Use Advanced Risk Management</label>
                                    <div class="form-text">Enable advanced risk management features</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="max-loss" class="form-label">Maximum Loss (%)</label>
                                    <input type="number" class="form-control" id="max-loss" value="2" min="0.1" max="10" step="0.1">
                                    <div class="form-text">Maximum allowed loss per trade as percentage of portfolio</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="max-daily-loss" class="form-label">Maximum Daily Loss (%)</label>
                                    <input type="number" class="form-control" id="max-daily-loss" value="5" min="0.5" max="20" step="0.5">
                                    <div class="form-text">Maximum allowed loss per day as percentage of portfolio</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="max-open-trades" class="form-label">Maximum Open Trades</label>
                                    <input type="number" class="form-control" id="max-open-trades" value="5" min="1" max="20">
                                    <div class="form-text">Maximum number of open trades at any time</div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="use-kelly" checked>
                                    <label class="form-check-label" for="use-kelly">Use Kelly Criterion</label>
                                    <div class="form-text">Use Kelly Criterion for position sizing</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="kelly-fraction" class="form-label">Kelly Fraction</label>
                                    <input type="number" class="form-control" id="kelly-fraction" value="0.5" min="0.1" max="1" step="0.1">
                                    <div class="form-text">Fraction of Kelly criterion to use (lower is more conservative)</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="max-drawdown" class="form-label">Maximum Drawdown (%)</label>
                                    <input type="number" class="form-control" id="max-drawdown" value="15" min="5" max="50" step="1">
                                    <div class="form-text">Maximum allowed drawdown before stopping trading</div>
                                </div>
                                
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="use-correlation-matrix" checked>
                                    <label class="form-check-label" for="use-correlation-matrix">Use Correlation Matrix</label>
                                    <div class="form-text">Consider asset correlations for risk management</div>
                                </div>
                            </div>
                        </div>
                        
                        <h5 class="mb-3">Volatility Filters</h5>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="use-volatility-filter" checked>
                            <label class="form-check-label" for="use-volatility-filter">Use Volatility Filter</label>
                            <div class="form-text">Adjust position size based on market volatility</div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="volatility-lookback" class="form-label">Volatility Lookback Period</label>
                                <input type="number" class="form-control" id="volatility-lookback" value="20" min="5" max="100">
                                <div class="form-text">Number of periods to use for volatility calculation</div>
                            </div>
                            <div class="col-md-6">
                                <label for="volatility-threshold" class="form-label">Volatility Threshold</label>
                                <input type="number" class="form-control" id="volatility-threshold" value="2" min="0.5" max="5" step="0.1">
                                <div class="form-text">Threshold for high volatility (multiplier of average)</div>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Save Risk Settings</button>
                    </form>
                </div>
                
                <!-- API Keys Tab -->
                <div class="tab-pane fade" id="api" role="tabpanel" aria-labelledby="api-tab">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i> API keys are stored securely and never exposed in logs or the UI.
                    </div>
                    
                    <form id="api-settings-form">
                        <h5 class="mb-3">Kraken API</h5>
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="kraken-api-key" class="form-label">API Key</label>
                                    <input type="password" class="form-control" id="kraken-api-key" value="●●●●●●●●●●●●●●●●●●●●">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="kraken-api-secret" class="form-label">API Secret</label>
                                    <input type="password" class="form-control" id="kraken-api-secret" value="●●●●●●●●●●●●●●●●●●●●">
                                </div>
                            </div>
                        </div>
                        
                        <h5 class="mb-3">Binance API</h5>
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="binance-api-key" class="form-label">API Key</label>
                                    <input type="password" class="form-control" id="binance-api-key" placeholder="Enter Binance API Key">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="binance-api-secret" class="form-label">API Secret</label>
                                    <input type="password" class="form-control" id="binance-api-secret" placeholder="Enter Binance API Secret">
                                </div>
                            </div>
                        </div>
                        
                        <h5 class="mb-3">Coinbase API</h5>
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="coinbase-api-key" class="form-label">API Key</label>
                                    <input type="password" class="form-control" id="coinbase-api-key" placeholder="Enter Coinbase API Key">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="coinbase-api-secret" class="form-label">API Secret</label>
                                    <input type="password" class="form-control" id="coinbase-api-secret" placeholder="Enter Coinbase API Secret">
                                </div>
                            </div>
                        </div>
                        
                        <h5 class="mb-3">External APIs</h5>
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="news-api-key" class="form-label">News API Key</label>
                                    <input type="password" class="form-control" id="news-api-key" value="●●●●●●●●●●●●●●●●●●●●">
                                    <div class="form-text">Used for sentiment analysis</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="onchain-api-key" class="form-label">On-Chain API Key</label>
                                    <input type="password" class="form-control" id="onchain-api-key" placeholder="Enter On-Chain API Key">
                                    <div class="form-text">Used for on-chain metrics (e.g., Glassnode)</div>
                                </div>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Save API Settings</button>
                    </form>
                </div>
                
                <!-- Notifications Tab -->
                <div class="tab-pane fade" id="notifications" role="tabpanel" aria-labelledby="notifications-tab">
                    <form id="notifications-settings-form">
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="enable-notifications" checked>
                            <label class="form-check-label" for="enable-notifications">Enable Notifications</label>
                        </div>
                        
                        <h5 class="mb-3">Notification Methods</h5>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="email-notifications" checked>
                            <label class="form-check-label" for="email-notifications">Email</label>
                        </div>
                        
                        <div class="mb-3" id="email-settings">
                            <label for="notification-email" class="form-label">Email Address</label>
                            <input type="email" class="form-control" id="notification-email" value="user@example.com">
                        </div>
                        
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="telegram-notifications">
                            <label class="form-check-label" for="telegram-notifications">Telegram</label>
                        </div>
                        
                        <div class="mb-3" id="telegram-settings" style="display: none;">
                            <label for="telegram-bot-token" class="form-label">Telegram Bot Token</label>
                            <input type="text" class="form-control mb-2" id="telegram-bot-token" placeholder="Enter Telegram Bot Token">
                            
                            <label for="telegram-chat-id" class="form-label">Telegram Chat ID</label>
                            <input type="text" class="form-control" id="telegram-chat-id" placeholder="Enter Telegram Chat ID">
                        </div>
                        
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="discord-notifications">
                            <label class="form-check-label" for="discord-notifications">Discord</label>
                        </div>
                        
                        <div class="mb-3" id="discord-settings" style="display: none;">
                            <label for="discord-webhook-url" class="form-label">Discord Webhook URL</label>
                            <input type="text" class="form-control" id="discord-webhook-url" placeholder="Enter Discord Webhook URL">
                        </div>
                        
                        <h5 class="mb-3">Notification Events</h5>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="trade-notifications" checked>
                            <label class="form-check-label" for="trade-notifications">Trades</label>
                            <div class="form-text">Notify when trades are executed</div>
                        </div>
                        
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="error-notifications" checked>
                            <label class="form-check-label" for="error-notifications">Errors</label>
                            <div class="form-text">Notify when errors occur</div>
                        </div>
                        
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="performance-notifications" checked>
                            <label class="form-check-label" for="performance-notifications">Performance</label>
                            <div class="form-text">Notify about performance milestones</div>
                        </div>
                        
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="model-notifications" checked>
                            <label class="form-check-label" for="model-notifications">Model Training</label>
                            <div class="form-text">Notify when models are trained</div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Save Notification Settings</button>
                    </form>
                </div>
                
                <!-- Advanced Tab -->
                <div class="tab-pane fade" id="advanced" role="tabpanel" aria-labelledby="advanced-tab">
                    <div class="alert alert-warning mb-4">
                        <i class="fas fa-exclamation-triangle me-2"></i> These settings are for advanced users only. Incorrect settings may cause the bot to malfunction.
                    </div>
                    
                    <form id="advanced-settings-form">
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <h5 class="mb-3">Performance</h5>
                                
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="use-gpu" checked>
                                    <label class="form-check-label" for="use-gpu">Use GPU</label>
                                    <div class="form-text">Use GPU for model training and inference if available</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="num-threads" class="form-label">Number of Threads</label>
                                    <input type="number" class="form-control" id="num-threads" value="4" min="1" max="32">
                                    <div class="form-text">Number of threads to use for parallel processing</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="memory-limit" class="form-label">Memory Limit (MB)</label>
                                    <input type="number" class="form-control" id="memory-limit" value="4096" min="1024" max="32768">
                                    <div class="form-text">Maximum memory to use for model training and inference</div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <h5 class="mb-3">Debug & Logging</h5>
                                
                                <div class="mb-3">
                                    <label for="log-level" class="form-label">Log Level</label>
                                    <select class="form-select" id="log-level">
                                        <option value="DEBUG">DEBUG</option>
                                        <option value="INFO" selected>INFO</option>
                                        <option value="WARNING">WARNING</option>
                                        <option value="ERROR">ERROR</option>
                                    </select>
                                    <div class="form-text">Minimum log level to record</div>
                                </div>
                                
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="log-to-console" checked>
                                    <label class="form-check-label" for="log-to-console">Log to Console</label>
                                    <div class="form-text">Output logs to console in addition to log file</div>
                                </div>
                                
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="debug-mode">
                                    <label class="form-check-label" for="debug-mode">Debug Mode</label>
                                    <div class="form-text">Enable additional debugging information</div>
                                </div>
                            </div>
                        </div>
                        
                        <h5 class="mb-3">Database Settings</h5>
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="db-type" class="form-label">Database Type</label>
                                    <select class="form-select" id="db-type">
                                        <option value="sqlite" selected>SQLite</option>
                                        <option value="mysql">MySQL</option>
                                        <option value="postgresql">PostgreSQL</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="db-path" class="form-label">Database Path/Name</label>
                                    <input type="text" class="form-control" id="db-path" value="crypto_trading_bot.db">
                                </div>
                            </div>
                            
                            <div class="col-md-6" id="db-connection-settings" style="display: none;">
                                <div class="mb-3">
                                    <label for="db-host" class="form-label">Host</label>
                                    <input type="text" class="form-control" id="db-host" value="localhost">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="db-port" class="form-label">Port</label>
                                    <input type="number" class="form-control" id="db-port" value="3306">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="db-user" class="form-label">Username</label>
                                    <input type="text" class="form-control" id="db-user" value="root">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="db-password" class="form-label">Password</label>
                                    <input type="password" class="form-control" id="db-password" placeholder="Enter database password">
                                </div>
                            </div>
                        </div>
                        
                        <h5 class="mb-3">Backup & Recovery</h5>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="enable-backups" checked>
                            <label class="form-check-label" for="enable-backups">Enable Automatic Backups</label>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="backup-interval" class="form-label">Backup Interval (hours)</label>
                                <input type="number" class="form-control" id="backup-interval" value="24" min="1" max="168">
                            </div>
                            <div class="col-md-6">
                                <label for="backup-location" class="form-label">Backup Location</label>
                                <input type="text" class="form-control" id="backup-location" value="backups/">
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="max-backups" class="form-label">Maximum Backups</label>
                            <input type="number" class="form-control" id="max-backups" value="7" min="1" max="100">
                            <div class="form-text">Maximum number of backups to keep</div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Save Advanced Settings</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    $(document).ready(function() {
        // Load settings from API
        function loadSettings() {
            $.getJSON('/api/settings', function(data) {
                // General settings
                $('#active-exchange').val(data.active_exchange || 'kraken');
                $('#update-interval').val(data.update_interval_hours || 1);
                $('#retrain-interval').val(data.retrain_interval_hours || 24);
                $('#use-enhanced-data').prop('checked', data.use_enhanced_data !== false);
                $('#use-performance-tracking').prop('checked', data.use_performance_tracking !== false);
                $('#model-dir').val(data.model_dir || 'models/trained_models');
                $('#log-file').val(data.log_file || 'crypto_trading_bot.log');
                
                // Trading settings
                $('#use-lstm').prop('checked', data.model_types?.includes('lstm') !== false);
                $('#use-hybrid').prop('checked', data.model_types?.includes('hybrid') !== false);
                $('#use-transformer').prop('checked', data.model_types?.includes('transformer') !== false);
                $('#use-reinforcement').prop('checked', data.model_types?.includes('ppo') !== false);
                $('#use-ensemble-weighting').prop('checked', data.use_ensemble_weighting !== false);
                $('#use-strategy-selector').prop('checked', data.use_strategy_selector !== false);
                
                // Risk settings
                $('#advanced-risk').prop('checked', data.advanced_risk !== false);
                $('#max-loss').val(data.max_loss || 2);
                $('#max-daily-loss').val(data.max_daily_loss || 5);
                $('#max-open-trades').val(data.max_open_trades || 5);
                $('#use-kelly').prop('checked', data.use_kelly !== false);
                $('#kelly-fraction').val(data.kelly_fraction || 0.5);
                $('#max-drawdown').val(data.max_drawdown || 15);
                $('#use-correlation-matrix').prop('checked', data.use_correlation_matrix !== false);
                
                // Update trading pairs
                if (data.trading_pairs && data.trading_pairs.length > 0) {
                    $('.trading-pairs-container').empty();
                    data.trading_pairs.forEach(pair => {
                        addTradingPair(pair);
                    });
                }
            });
        }
        
        // Save settings
        function saveSettings(formId, successMessage) {
            const form = $(`#${formId}`);
            const formData = {};
            
            // Serialize form data
            form.find('input, select, textarea').each(function() {
                const input = $(this);
                const id = input.attr('id');
                
                if (input.attr('type') === 'checkbox') {
                    formData[id.replace(/-/g, '_')] = input.prop('checked');
                } else {
                    formData[id.replace(/-/g, '_')] = input.val();
                }
            });
            
            // Special handling for trading pairs
            if (formId === 'general-settings-form') {
                formData.trading_pairs = [];
                $('.trading-pair-select').each(function() {
                    formData.trading_pairs.push($(this).val());
                });
            }
            
            // Send to API
            $.ajax({
                url: '/api/settings',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(formData),
                success: function(response) {
                    if (response.success) {
                        alert(successMessage || 'Settings saved successfully');
                    } else {
                        alert('Error saving settings: ' + response.message);
                    }
                },
                error: function() {
                    alert('Error saving settings. Please try again.');
                }
            });
        }
        
        // Add trading pair
        function addTradingPair(selectedPair = 'BTC/USD') {
            const pairHtml = `
                <div class="d-flex mb-2">
                    <select class="form-select me-2 trading-pair-select">
                        <option value="BTC/USD" ${selectedPair === 'BTC/USD' ? 'selected' : ''}>BTC/USD</option>
                        <option value="ETH/USD" ${selectedPair === 'ETH/USD' ? 'selected' : ''}>ETH/USD</option>
                        <option value="XRP/USD" ${selectedPair === 'XRP/USD' ? 'selected' : ''}>XRP/USD</option>
                        <option value="DOGE/USD" ${selectedPair === 'DOGE/USD' ? 'selected' : ''}>DOGE/USD</option>
                        <option value="SHIB/USD" ${selectedPair === 'SHIB/USD' ? 'selected' : ''}>SHIB/USD</option>
                        <option value="SOL/USD" ${selectedPair === 'SOL/USD' ? 'selected' : ''}>SOL/USD</option>
                        <option value="ADA/USD" ${selectedPair === 'ADA/USD' ? 'selected' : ''}>ADA/USD</option>
                        <option value="DOT/USD" ${selectedPair === 'DOT/USD' ? 'selected' : ''}>DOT/USD</option>
                    </select>
                    <button type="button" class="btn btn-outline-danger remove-pair-btn">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            $('.trading-pairs-container').append(pairHtml);
        }
        
        // Handle form submissions
        $('#general-settings-form').submit(function(e) {
            e.preventDefault();
            saveSettings('general-settings-form', 'General settings saved successfully');
        });
        
        $('#trading-settings-form').submit(function(e) {
            e.preventDefault();
            saveSettings('trading-settings-form', 'Trading settings saved successfully');
        });
        
        $('#risk-settings-form').submit(function(e) {
            e.preventDefault();
            saveSettings('risk-settings-form', 'Risk management settings saved successfully');
        });
        
        $('#api-settings-form').submit(function(e) {
            e.preventDefault();
            saveSettings('api-settings-form', 'API settings saved successfully');
        });
        
        $('#notifications-settings-form').submit(function(e) {
            e.preventDefault();
            saveSettings('notifications-settings-form', 'Notification settings saved successfully');
        });
        
        $('#advanced-settings-form').submit(function(e) {
            e.preventDefault();
            saveSettings('advanced-settings-form', 'Advanced settings saved successfully');
        });
        
        // Handle add/remove trading pair
        $('#add-pair-btn').click(function() {
            addTradingPair();
        });
        
        $(document).on('click', '.remove-pair-btn', function() {
            // Don't remove if it's the last pair
            if ($('.trading-pair-select').length > 1) {
                $(this).closest('.d-flex').remove();
            } else {
                alert('You must have at least one trading pair');
            }
        });
        
        // Toggle trading schedule container
        $('#use-trading-schedule').change(function() {
            if ($(this).prop('checked')) {
                $('#trading-schedule-container').show();
            } else {
                $('#trading-schedule-container').hide();
            }
        });
        
        // Toggle database connection settings
        $('#db-type').change(function() {
            if ($(this).val() === 'sqlite') {
                $('#db-connection-settings').hide();
            } else {
                $('#db-connection-settings').show();
            }
        });
        
        // Toggle notification method settings
        $('#telegram-notifications').change(function() {
            if ($(this).prop('checked')) {
                $('#telegram-settings').show();
            } else {
                $('#telegram-settings').hide();
            }
        });
        
        $('#discord-notifications').change(function() {
            if ($(this).prop('checked')) {
                $('#discord-settings').show();
            } else {
                $('#discord-settings').hide();
            }
        });
        
        // Initial load
        loadSettings();
    });
</script>
{% endblock %}
